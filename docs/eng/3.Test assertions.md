# FileSystem Assertions Documentation

`TheMakarik.Testing.FileSystem` provides advanced capabilities for validating the state of a file system in integration tests. Assertions (asserts) allow you to conveniently check file contents, directory structures, and other file system properties, making testing more readable and maintainable.

## Example of Using Assertions

```csharp
using TheMakarik.Testing.FileSystem;
using Xunit;

namespace LearnFileSystemProject;

// xUnit.net class
public class AssertionExamples : IDisposable
{
    private IFileSystem _fileSystem;
    private string[] _filePaths;
    private string _directory1;

    public AssertionExamples()
    {
        _fileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFiles(["file-1.txt", "file-2.txt", "file-3.txt"], "Test content", out _filePaths)
            .AddDirectory("dir-1", out _directory1)
            .Build();
    }

    [Fact]
    public void File1_MustHaveContent()
    {
        _fileSystem.Should()
            .FileContentEquals("file-1.txt", "Test content");
    }

    [Fact]
    public void Directory1_MustHaveNoContent()
    {
        _fileSystem
            .Should()
            .HasNoDirectoryContent(_directory1);
    }

    [Fact]
    public void Files_MustExist()
    {
        _fileSystem.Should()
            .FileExists("file-1.txt")
            .FileExists("file-2.txt")
            .FileExists("file-3.txt");
    }

    [Fact]
    public void ConfigFile_MustBeValidJson()
    {
        var testFileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFile("config.json", "{ \"enabled\": true, \"timeout\": 30 }")
            .Build();

        testFileSystem.Should()
            .FileExists("config.json")
            .FileContains("config.json", "enabled")
            .FileMatchesRegex("config.json", "\"timeout\"\\s*:\\s*30");
        
        testFileSystem.Dispose();
    }

    public void Dispose()
    {
        _fileSystem.Dispose();
    }
}
```

Assertion methods work with a fluent interface and have the following overloads and categories.

## Main Assertion Methods

### Should() Method
```csharp
public static IFileSystemAssertion Should(this IFileSystem fileSystem)
```
Creates an assertion instance for the specified file system. All subsequent checks will be performed relative to the root directory of this file system.

You are able to use  `No` property, to make asserts falls on the valid results and be passed on the invalid results

## File and Directory Existence Checks

### 1) Check if File or Directory Exists
```csharp
public static IFileSystemAssertion Contains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file or directory exists at the specified path. `string rootRelativePath` - relative path from the root directory.

**Example:**
```csharp
_fileSystem.Should().Contains("file.txt");
```

### 2) Check if File or Directory Does NOT Exist
```csharp
public static IFileSystemAssertion NotContains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file or directory does NOT exist at the specified path.

**Example:**
```csharp
_fileSystem.Should().NotContains("deleted-file.txt");
```

### 3) Check if Specific File Exists
```csharp
public static IFileSystemAssertion FileExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file (not a directory) exists at the specified path.

**Example:**
```csharp
_fileSystem.Should().FileExists("config.json");
```

### 4) Check if Specific Directory Exists
```csharp
public static IFileSystemAssertion DirectoryExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a directory (not a file) exists at the specified path.

**Example:**
```csharp
_fileSystem.Should().DirectoryExists("logs");
```

## File Content Checks

### 1) Check if File is Not Empty
```csharp
public static IFileSystemAssertion BeNotEmptyFile(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that the file exists and contains at least one line.

**Example:**
```csharp
_fileSystem.Should().BeNotEmptyFile("log.txt");
```

### 2) Check Exact Content Match
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content)
```
Checks that the file content exactly matches the specified string. Comparison is case-sensitive.

**Example:**
```csharp
_fileSystem.Should().FileContentEquals("readme.txt", "Hello World!");
```

### 3) Check Exact Content Match with Comparison Rules
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content,
    StringComparison comparisonType)
```
Checks that the file content matches the specified string using the given comparison rules.

**Example:**
```csharp
_fileSystem.Should().FileContentEquals("config.txt", "ENABLED=true", StringComparison.OrdinalIgnoreCase);
```

### 4) Check if File Contains Specified Text
```csharp
public static IFileSystemAssertion FileContains(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string text, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file contains the specified text. You can specify string comparison rules.

**Example:**
```csharp
_fileSystem.Should()
    .FileContains("log.txt", "ERROR")
    .FileContains("config.txt", "localhost", StringComparison.OrdinalIgnoreCase);
```

### 5) Check if File Matches Regular Expression
```csharp
public static IFileSystemAssertion FileMatchesRegex(this IFileSystemAssertion assertion, string rootRelativePath, string pattern)
```
Checks that the file content matches the specified regular expression.

**Example:**
```csharp
_fileSystem.Should().FileMatchesRegex("config.txt", "^\\s*\\w+\\s*=\\s*\\w+\\s*$");
```

### 6) Check if File Starts with Specified Text
```csharp
public static IFileSystemAssertion FileStartsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string startingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file starts with the specified text.

**Example:**
```csharp
_fileSystem.Should().FileStartsWith("script.sh", "#!/bin/bash");
```

### 7) Check if File Ends with Specified Text
```csharp
public static IFileSystemAssertion FileEndsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string endingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file ends with the specified text.

**Example:**
```csharp
_fileSystem.Should().FileEndsWith("data.json", "\n}");
```

## File Size Checks

### 1) Check if File is Empty
```csharp
public static IFileSystemAssertion FileIsEmpty(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that the file exists and has a size of 0 bytes.

**Example:**
```csharp
_fileSystem.Should().FileIsEmpty("placeholder.txt");
```

### 2) Check File Size
```csharp
public static IFileSystemAssertion FileHasSize(this IFileSystemAssertion assertion, string rootRelativePath, long expectedSize)
```
Checks that the file has the specified size in bytes.

**Example:**
```csharp
_fileSystem.Should().FileHasSize("data.bin", 1024); // 1KB
```

## File Date Checks

### 1) Check if File Was Modified After Specified Date
```csharp
public static IFileSystemAssertion FileModifiedAfter(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Checks that the file was modified after the specified date and time.

**Example:**
```csharp
_fileSystem.Should().FileModifiedAfter("log.txt", DateTime.Now.AddHours(-1));
```

### 2) Check if File Was Created Before Specified Date
```csharp
public static IFileSystemAssertion FileCreatedBefore(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Checks that the file was created before the specified date and time.

**Example:**
```csharp
_fileSystem.Should().FileCreatedBefore("archive.zip", DateTime.Now.AddDays(-7));
```

## File Attribute Checks

### 1) Check if File Has Specified Attributes
```csharp
public static IFileSystemAssertion FileHasAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Checks that the file has the specified attributes.

**Example:**
```csharp
_fileSystem.Should().FileHasAttributes("script.sh", FileAttributes.Archive | FileAttributes.ReadOnly);
```

### 2) Check if File Does NOT Have Specified Attributes
```csharp
public static IFileSystemAssertion FileDoesNotHaveAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Checks that the file does NOT have the specified attributes.

**Example:**
```csharp
_fileSystem.Should().FileDoesNotHaveAttributes("data.txt", FileAttributes.Hidden);
```

## Directory Checks

### 1) Check if Directory is Empty
```csharp
public static IFileSystemAssertion HasNoDirectoryContent(this IFileSystemAssertion assertion, string? rootRelativePath = null)
```
Checks that the directory contains no files or subdirectories. If no parameter is specified, checks the root directory.

**Example:**
```csharp
_fileSystem.Should()
    .HasNoDirectoryContent("empty-dir")
    .HasNoDirectoryContent(); // Checks root directory
```

### 2) Check File Count in Directory
```csharp
public static IFileSystemAssertion DirectoryHasFileCount(this IFileSystemAssertion assertion, string rootRelativePath, int expectedCount)
```
Checks that the directory contains the specified number of files.

**Example:**
```csharp
_fileSystem.Should().DirectoryHasFileCount("logs", 5);
```

### 3) Check if Directory Contains Files with Specific Extension
```csharp
public static IFileSystemAssertion DirectoryContainsFileWithExtension(this IFileSystemAssertion assertion, string rootRelativePath, string extension)
```
Checks that the directory contains at least one file with the specified extension.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsFileWithExtension("documents", ".pdf");
```

## File Comparison

### 1) Compare Two Files
```csharp
public static IFileSystemAssertion FilesAreEqual(this IFileSystemAssertion assertion, string firstFilePath, string secondFilePath)
```
Checks that the contents of two files are identical (byte-by-byte comparison).

**Example:**
```csharp
_fileSystem.Should().FilesAreEqual("original.txt", "backup.txt");
```

## Custom Validation Methods

### 1) Custom Item Validation
```csharp
public static IFileSystemAssertion ItemBe(this IFileSystemAssertion assertion, string rootRelativePath, Predicate<string> predicate)
```
Allows you to perform a custom validation using the specified predicate. The predicate receives the full path to the file or directory.

*This method can also be used to create custom extension methods for assertions, although it's still recommended to use the low-level Validate() method (which will be discussed later) due to the inability to control the error message*

**Example:**
```csharp
_fileSystem.Should().ItemBe("data.csv", path => 
{
    var content = File.ReadAllText(path);
    return content.Contains("Total") && content.EndsWith("\n");
});
```

### 2) Custom Root Filesystem Validation
```csharp
public static IFileSystemAssertion Be(this IFileSystemAssertion assertion, Predicate<IFileSystem> predicate)
```
Allows you to perform a custom validation of the entire file system. The predicate receives an instance of `IFileSystem`, enabling you to check any aspect of the file system.

*This method is particularly useful for complex validations that involve the entire file system structure or require access to the root directory*

**Example:**
```csharp
_fileSystem.Should().Be(fileSystem => 
{
    // Check that the root directory exists
    if (!Directory.Exists(fileSystem.Root))
        return false;
    
    // Check total size of all files
    var allFiles = Directory.GetFiles(fileSystem.Root, "*", SearchOption.AllDirectories);
    var totalSize = allFiles.Sum(file => new FileInfo(file).Length);
    
    // Limit total size to 10MB
    return totalSize < 10 * 1024 * 1024;
});
```

**Additional example with project structure validation:**
```csharp
_fileSystem.Should().Be(fileSystem => 
{
    var root = fileSystem.Root;
    
    // Check for required directories
    var requiredDirectories = new[] { "src", "tests", "docs", "config" };
    foreach (var dir in requiredDirectories)
    {
        if (!Directory.Exists(Path.Combine(root, dir)))
            return false;
    }
    
    // Check for README file
    if (!File.Exists(Path.Combine(root, "README.md")))
        return false;
    
    // Check that there are no temporary files in the root
    var tempFiles = Directory.GetFiles(root, "*.tmp");
    return tempFiles.Length == 0;
});
```

**Example with permission checking:**
```csharp
_fileSystem.Should().Be(fileSystem => 
{
    var root = fileSystem.Root;
    var directories = Directory.GetDirectories(root);
    
    // Check that all directories are readable
    foreach (var dir in directories)
    {
        try
        {
            Directory.GetFiles(dir);
        }
        catch (UnauthorizedAccessException)
        {
            return false; // No access to directory
        }
    }
    
    return true;
});
```

## Root Directory Structure Validations

### 1) Verify Exact Content of Root Directory
```csharp
public static IFileSystemAssertion ContentEquals(
    this IFileSystemAssertion assertion,
    IEnumerable<string> expectedItems)
```
Validates that the root directory contains exactly the specified files and subdirectories. Comparison is case-sensitive.

**Example:**
```csharp
_fileSystem.Should()
    .ContentEquals(["README.md", "src", "tests", "config"]);
```

### 2) Verify Root Directory Contains Only Files
```csharp
public static IFileSystemAssertion ContentContainsOnlyFiles(
    this IFileSystemAssertion assertion)
```
Validates that the root directory contains no subdirectories. Does not verify file count or names.

**Example:**
```csharp
// Verify that root contains only files (no folders)
_fileSystem.Should().ContentContainsOnlyFiles();
```

### 3) Verify Root Directory Contains Only Directories
```csharp
public static IFileSystemAssertion ContentContainsOnlyDirectories(
    this IFileSystemAssertion assertion)
```
Validates that the root directory contains no files. Does not verify directory count or names.

**Example:**
```csharp
// Verify that root contains only folders (e.g., modular project structure)
_fileSystem.Should().ContentContainsOnlyDirectories();
```

### 4) Verify Total File System Size
```csharp
public static IFileSystemAssertion TotalSizeLessThan(
    this IFileSystemAssertion assertion,
    long maxSizeInBytes)
```
Validates that the total size of all files in the file system (including nested directories) does not exceed the specified limit.

**Example:**
```csharp
// Verify entire project is under 10MB
_fileSystem.Should().TotalSizeLessThan(10 * 1024 * 1024);
```

### 5) Verify Total File Count
```csharp
public static IFileSystemAssertion TotalFileCount(
    this IFileSystemAssertion assertion,
    int expectedFileCount)
```
Validates the exact number of files in the entire file system (recursively includes all subdirectories).

**Example:**
```csharp
// Project must contain exactly 42 files
_fileSystem.Should().TotalFileCount(42);
```

### 6) Verify No Duplicate File Names
```csharp
public static IFileSystemAssertion NoDuplicateFileNames(
    this IFileSystemAssertion assertion)
```
Validates that all files in the file system have unique names (case-sensitive).

**Example:**
```csharp
// Ensure there are no files with duplicate names
_fileSystem.Should().NoDuplicateFileNames();
```

### 7) Verify File Name Patterns
```csharp
public static IFileSystemAssertion AllFilesMatchNamePattern(
    this IFileSystemAssertion assertion,
    string namePattern)
```
Validates that all files match the specified regular expression pattern. Only checks the file name (without extension).

**Example:**
```csharp
// All files must start with "module_" prefix
_fileSystem.Should().AllFilesMatchNamePattern("^module_.*$");
```

### 8) Search for Files with Specific Content
```csharp
public static IFileSystemAssertion ContainsFileWithText(
    this IFileSystemAssertion assertion,
    string searchText,
    StringComparison stringComparison = StringComparison.Ordinal)
```
Validates that at least one file in the file system contains the specified text.

**Example:**
```csharp
// Verify there's a TODO comment somewhere in the project
_fileSystem.Should().ContainsFileWithText("TODO");
```

### 9) Verify Maximum Directory Nesting Depth
```csharp
public static IFileSystemAssertion MaxDirectoryDepth(
    this IFileSystemAssertion assertion,
    int maxDepth)
```
Validates that directory nesting depth does not exceed the specified maximum.

**Example:**
```csharp
// Limit directory nesting to 3 levels
_fileSystem.Should().MaxDirectoryDepth(3);
```

### 10) Verify Naming Convention Compliance
```csharp
public static IFileSystemAssertion FollowsNamingConvention(
    this IFileSystemAssertion assertion,
    Func<string, bool> conventionValidator)
```
Allows validation that all items in the root directory follow a specific naming convention rule.

**Example:**
```csharp
// Verify all names are in lowercase
_fileSystem.Should().FollowsNamingConvention(name => 
    name == name.ToLowerInvariant());

// Verify no files contain spaces
_fileSystem.Should().FollowsNamingConvention(name => 
    !name.Contains(' '));
```

## Usage Examples

### Example 1: Project Structure Validation
```csharp
[Fact]
public void ProjectStructure_ShouldMeetStandards()
{
    _fileSystem.Should()
        .ContentEquals(["src", "tests", "docs", "README.md", ".gitignore"])
        .AllFilesMatchNamePattern("^[a-z][a-z0-9_]*$")
        .TotalSizeLessThan(5 * 1024 * 1024)
        .NoDuplicateFileNames();
}
```

### Example 2: Build Artifact Limitations
```csharp
[Fact]
public void BuildArtifacts_ShouldBeWithinLimits()
{
    _fileSystem.Should()
        .TotalFileCount(150)
        .TotalSizeLessThan(50 * 1024 * 1024)
        .ContainsFileWithText("Version: 1.0.0")
        .MaxDirectoryDepth(4);
}
```

### Example 3: Coding Convention Compliance
```csharp
[Fact]
public void Codebase_ShouldFollowNamingConventions()
{
    _fileSystem.Should()
        .FollowsNamingConvention(name => 
            !name.Contains(' ') && 
            !name.Contains('_'))
        .AllFilesHaveExtensions("src", ".cs", ".csproj", ".sln")
        .ContentContainsOnlyDirectories(); // src folder should contain only directories
}
```

## Directory Content Checks

### 1) Check if Directory Contains File by Name
```csharp
public static IFileSystemAssertion DirectoryContainsFile(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    string fileName,
    SearchOption searchOption = SearchOption.TopDirectoryOnly)
```
Checks that the directory contains a file with the specified name.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsFile("logs", "app.log", SearchOption.AllDirectories);
```

### 2) Check if Directory Contains Subdirectory by Name
```csharp
public static IFileSystemAssertion DirectoryContainsSubdirectory(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    string directoryName,
    SearchOption searchOption = SearchOption.TopDirectoryOnly)
```
Checks that the directory contains a subdirectory with the specified name.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsSubdirectory("project", "src", SearchOption.AllDirectories);
```

### 3) Check if Directory Contains All Specified Files
```csharp
public static IFileSystemAssertion DirectoryContainsAllFiles(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    params string[] fileNames)
```
Checks that the directory contains all files from the specified list.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsAllFiles("config", "appsettings.json", "web.config");
```

### 4) Check if Directory Contains Exactly the Specified Files
```csharp
public static IFileSystemAssertion DirectoryContainsExactlyFiles(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    params string[] fileNames)
```
Checks that the directory contains exactly the specified files and no others.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsExactlyFiles("bin", "app.dll", "app.pdb");
```

### 5) Check if All Files in Directory Satisfy Predicate
```csharp
public static IFileSystemAssertion AllFilesInDirectorySatisfy(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    Predicate<string> predicate)
```
Checks that all files in the directory satisfy the specified predicate.

**Example:**
```csharp
_fileSystem.Should().AllFilesInDirectorySatisfy("logs", fileName => fileName.EndsWith(".log"));
```

### 6) Check if Directory Contains at Least One File Satisfying Predicate
```csharp
public static IFileSystemAssertion DirectoryContainsFileSatisfying(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    Predicate<string> predicate)
```
Checks that the directory contains at least one file that satisfies the specified predicate.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsFileSatisfying("data", fileName => fileName.Contains("backup"));
```

### 7) Check Subdirectory Count
```csharp
public static IFileSystemAssertion DirectoryHasSubdirectoryCount(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    int expectedCount)
```
Checks that the directory contains the specified number of subdirectories.

**Example:**
```csharp
_fileSystem.Should().DirectoryHasSubdirectoryCount("project", 3);
```

### 8) Check if All Files Have Specified Extensions
```csharp
public static IFileSystemAssertion AllFilesHaveExtensions(
    this IFileSystemAssertion assertion,
    string rootRelativePath,
    params string[] extensions)
```
Checks that all files in the directory have one of the specified extensions.

**Example:**
```csharp
_fileSystem.Should().AllFilesHaveExtensions("source", ".cs", ".csproj");
```

## Usage Examples

### Example 1: Comprehensive Application Configuration Validation
```csharp
[Fact]
public void ApplicationConfiguration_ShouldBeValid()
{
    _fileSystem.Should()
        .FileExists("appsettings.json")
        .FileContains("appsettings.json", "\"ConnectionStrings\"")
        .FileMatchesRegex("appsettings.json", "\"Logging\"\\s*:")
        .DirectoryExists("logs")
        .DirectoryHasFileCount("logs", 3)
        .DirectoryContainsFileWithExtension("logs", ".log");
}
```

### Example 2: Temporary Files Cleanup Verification
```csharp
[Fact]
public void TemporaryFiles_ShouldBeCleanedUp()
{
    _fileSystem.Should()
        .NotContains("temp-data.tmp")
        .NotContains("cache.bin")
        .HasNoDirectoryContent("temp")
        .FileExists("permanent-config.xml")
        .FileContentEquals("permanent-config.xml", "<config></config>");
}
```

### Example 3: Project Structure Validation
```csharp
[Fact]
public void ProjectStructure_ShouldBeCorrect()
{
    _fileSystem.Should()
        .DirectoryExists("src")
        .DirectoryExists("tests")
        .FileExists("README.md")
        .FileExists("LICENSE")
        .FileExists(".gitignore")
        .FileContains("README.md", "# Project Name")
        .DirectoryContainsAllFiles("src", "Program.cs", "Startup.cs")
        .AllFilesHaveExtensions("src", ".cs");
}
```

### Example 4: File Security Validation
```csharp
[Fact]
public void SecurityFiles_ShouldHaveCorrectPermissions()
{
    _fileSystem.Should()
        .FileHasAttributes("secret.key", FileAttributes.ReadOnly)
        .FileDoesNotHaveAttributes("public.txt", FileAttributes.ReadOnly)
        .FileExists("admin-credentials.txt")
        .FileHasAttributes("admin-credentials.txt", FileAttributes.Hidden);
}
```

Using these assertions makes tests more expressive and maintainable, and also simplifies problem diagnosis when tests fail.mplifies problem diagnosis when tests fail.