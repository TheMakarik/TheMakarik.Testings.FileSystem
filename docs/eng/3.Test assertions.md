# FileSystem Assertions Documentation

`TheMakarik.Testing.FileSystem` provides an advanced interface for checking the state of the file system in integration tests. Assertions (asserts) allow you to conveniently check file contents, directory structures, and other file system properties, making testing more readable and maintainable.

## Example of Using Assertions

```csharp
using TheMakarik.Testing.FileSystem;
using Xunit;

namespace LearnFileSystemProject;

public class AssertionExamples : IDisposable
{
    private IFileSystem _fileSystem;
    private string[] _filePaths;
    private string _directory1;

    public AssertionExamples()
    {
        _fileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFiles(["file-1.txt", "file-2.txt", "file-3.txt"], "Test content", out _filePaths)
            .AddDirectory("dir-1", out _directory1)
            .Build();
    }

    [Fact]
    public void File1_MustHaveContent()
    {
        _fileSystem.Should()
            .FileContentEquals("file-1.txt", "Test content");
    }

    [Fact]
    public void Directory1_MustHaveNoContent()
    {
        _fileSystem
            .Should()
            .HasNoDirectoryContent(_directory1);
    }

    [Fact]
    public void Files_MustExist()
    {
        _fileSystem.Should()
            .FileExists("file-1.txt")
            .FileExists("file-2.txt")
            .FileExists("file-3.txt");
    }

    [Fact]
    public void ConfigFile_MustBeValidJson()
    {
        var testFileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFile("config.json", "{ \"enabled\": true, \"timeout\": 30 }")
            .Build();

        testFileSystem.Should()
            .FileExists("config.json")
            .FileContains("config.json", "enabled")
            .FileMatchesRegex("config.json", "\"timeout\"\\s*:\\s*30");
        
        testFileSystem.Dispose();
    }

    public void Dispose()
    {
        _fileSystem.Dispose();
    }
}
```

From the example, we can see that checking the state of the file system is quite simple. It looks more declarative and readable than using standard `Assert.True(File.Exists(...))` or `Assert.Equal(expected, File.ReadAllText(...))`.

Assertion methods work with a fluent interface and have the following overloads and categories.

## Basic Assertion Methods

### Should() Method
```csharp
public static IFileSystemAssertion Should(this IFileSystem fileSystem)
```
Creates an assertion instance for the specified file system. All subsequent checks will be performed relative to the root directory of this file system.

## File and Directory Existence Checks

### 1) Checking existence of a file or directory
```csharp
public static IFileSystemAssertion Contains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file or directory exists at the specified path. `string rootRelativePath` - relative path from the root directory.

**Example:**
```csharp
_fileSystem.Should().Contains("file.txt");
```

### 2) Checking absence of a file or directory
```csharp
public static IFileSystemAssertion NotContains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file or directory does NOT exist at the specified path.

**Example:**
```csharp
_fileSystem.Should().NotContains("deleted-file.txt");
```

### 3) Checking existence of a specific file
```csharp
public static IFileSystemAssertion FileExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file (not a directory) exists at the specified path.

**Example:**
```csharp
_fileSystem.Should().FileExists("config.json");
```

### 4) Checking existence of a specific directory
```csharp
public static IFileSystemAssertion DirectoryExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a directory (not a file) exists at the specified path.

**Example:**
```csharp
_fileSystem.Should().DirectoryExists("logs");
```

## File Content Checks

### 1) Checking that a file is not empty
```csharp
public static IFileSystemAssertion BeNotEmptyFile(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that a file exists and contains at least one line.

**Example:**
```csharp
_fileSystem.Should().BeNotEmptyFile("log.txt");
```

### 2) Checking exact content match
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content)
```
Checks that the file content exactly matches the specified string. Comparison is case-sensitive.

**Example:**
```csharp
_fileSystem.Should().FileContentEquals("readme.txt", "Hello World!");
```

### 3) Checking exact content match with specified comparison
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content,
    StringComparison comparisonType)
```
Checks that the file content matches the specified string using the given comparison rules.

**Example:**
```csharp
_fileSystem.Should().FileContentEquals("config.txt", "ENABLED=true", StringComparison.OrdinalIgnoreCase);
```

### 4) Checking that a file contains specified text
```csharp
public static IFileSystemAssertion FileContains(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string text, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file contains the specified text. You can specify string comparison rules.

**Example:**
```csharp
_fileSystem.Should()
    .FileContains("log.txt", "ERROR")
    .FileContains("config.txt", "localhost", StringComparison.OrdinalIgnoreCase);
```

### 5) Checking that a file matches a regular expression
```csharp
public static IFileSystemAssertion FileMatchesRegex(this IFileSystemAssertion assertion, string rootRelativePath, string pattern)
```
Checks that the file content matches the specified regular expression.

**Example:**
```csharp
_fileSystem.Should().FileMatchesRegex("config.txt", "^\\s*\\w+\\s*=\\s*\\w+\\s*$");
```

### 6) Checking that a file starts with specified text
```csharp
public static IFileSystemAssertion FileStartsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string startingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file starts with the specified text.

**Example:**
```csharp
_fileSystem.Should().FileStartsWith("script.sh", "#!/bin/bash");
```

### 7) Checking that a file ends with specified text
```csharp
public static IFileSystemAssertion FileEndsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string endingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Checks that the file ends with the specified text.

**Example:**
```csharp
_fileSystem.Should().FileEndsWith("data.json", "\n}");
```

## File Size Checks

### 1) Checking that a file is empty
```csharp
public static IFileSystemAssertion FileIsEmpty(this IFileSystemAssertion assertion, string rootRelativePath)
```
Checks that the file exists and has a size of 0 bytes.

**Example:**
```csharp
_fileSystem.Should().FileIsEmpty("placeholder.txt");
```

### 2) Checking file size
```csharp
public static IFileSystemAssertion FileHasSize(this IFileSystemAssertion assertion, string rootRelativePath, long expectedSize)
```
Checks that the file has the specified size in bytes.

**Example:**
```csharp
_fileSystem.Should().FileHasSize("data.bin", 1024); // 1KB
```

## File Date Checks

### 1) Checking that a file was modified after a specified date
```csharp
public static IFileSystemAssertion FileModifiedAfter(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Checks that the file was modified after the specified date and time.

**Example:**
```csharp
_fileSystem.Should().FileModifiedAfter("log.txt", DateTime.Now.AddHours(-1));
```

### 2) Checking that a file was created before a specified date
```csharp
public static IFileSystemAssertion FileCreatedBefore(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Checks that the file was created before the specified date and time.

**Example:**
```csharp
_fileSystem.Should().FileCreatedBefore("archive.zip", DateTime.Now.AddDays(-7));
```

## File Attribute Checks

### 1) Checking file attributes
```csharp
public static IFileSystemAssertion FileHasAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Checks that the file has the specified attributes.

**Example:**
```csharp
_fileSystem.Should().FileHasAttributes("script.sh", FileAttributes.Archive | FileAttributes.ReadOnly);
```

### 2) Checking absence of file attributes
```csharp
public static IFileSystemAssertion FileDoesNotHaveAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Checks that the file does NOT have the specified attributes.

**Example:**
```csharp
_fileSystem.Should().FileDoesNotHaveAttributes("data.txt", FileAttributes.Hidden);
```

## Directory Checks

### 1) Checking that a directory is empty
```csharp
public static IFileSystemAssertion HasNoDirectoryContent(this IFileSystemAssertion assertion, string? rootRelativePath = null)
```
Checks that the directory contains no files or subdirectories. If no parameter is specified, checks the root directory.

**Example:**
```csharp
_fileSystem.Should()
    .HasNoDirectoryContent("empty-dir")
    .HasNoDirectoryContent(); // Checks the root directory
```

### 2) Checking file count in a directory
```csharp
public static IFileSystemAssertion DirectoryHasFileCount(this IFileSystemAssertion assertion, string rootRelativePath, int expectedCount)
```
Checks that the directory contains the specified number of files.

**Example:**
```csharp
_fileSystem.Should().DirectoryHasFileCount("logs", 5);
```

### 3) Checking for files with a specific extension
```csharp
public static IFileSystemAssertion DirectoryContainsFileWithExtension(this IFileSystemAssertion assertion, string rootRelativePath, string extension)
```
Checks that the directory contains at least one file with the specified extension.

**Example:**
```csharp
_fileSystem.Should().DirectoryContainsFileWithExtension("documents", ".pdf");
```

## File Comparison

### 1) Comparing two files
```csharp
public static IFileSystemAssertion FilesAreEqual(this IFileSystemAssertion assertion, string firstFilePath, string secondFilePath)
```
Checks that the contents of two files are identical (byte-by-byte comparison).

**Example:**
```csharp
_fileSystem.Should().FilesAreEqual("original.txt", "backup.txt");
```

## Custom Checks

### 1) Custom check
```csharp
public static IFileSystemAssertion ItemBe(this IFileSystemAssertion assertion, string rootRelativePath, Predicate<string> predicate)
```
Allows you to perform a custom check using the specified predicate. The predicate receives the full path to the file or directory.

**Example:**
```csharp
_fileSystem.Should().ItemBe("data.csv", path => 
{
    var content = File.ReadAllText(path);
    return content.Contains("Total") && content.EndsWith("\n");
});
```

## Usage Examples

### Example 1: Comprehensive application configuration check
```csharp
[Fact]
public void ApplicationConfiguration_ShouldBeValid()
{
    _fileSystem.Should()
        .FileExists("appsettings.json")
        .FileContains("appsettings.json", "\"ConnectionStrings\"")
        .FileMatchesRegex("appsettings.json", "\"Logging\"\\s*:")
        .DirectoryExists("logs")
        .DirectoryHasFileCount("logs", 3)
        .DirectoryContainsFileWithExtension("logs", ".log");
}
```

### Example 2: Temporary file cleanup check
```csharp
[Fact]
public void TemporaryFiles_ShouldBeCleanedUp()
{
    // After cleanup operation
    _fileSystem.Should()
        .NotContains("temp-data.tmp")
        .NotContains("cache.bin")
        .HasNoDirectoryContent("temp")
        .FileExists("permanent-config.xml")
        .FileContentEquals("permanent-config.xml", "<config></config>");
}
```

### Example 3: Permission check
```csharp
[Fact]
public void SecurityFiles_ShouldHaveCorrectPermissions()
{
    _fileSystem.Should()
        .FileHasAttributes("secret.key", FileAttributes.ReadOnly)
        .FileDoesNotHaveAttributes("public.txt", FileAttributes.ReadOnly)
        .FileExists("admin-credentials.txt")
        .FileHasAttributes("admin-credentials.txt", FileAttributes.Hidden);
}
```

### Example 4: Project structure check
```csharp
[Fact]
public void ProjectStructure_ShouldBeCorrect()
{
    _fileSystem.Should()
        .DirectoryExists("src")
        .DirectoryExists("tests")
        .FileExists("README.md")
        .FileExists("LICENSE")
        .FileExists(".gitignore")
        .FileContains("README.md", "# Project Name")
        .DirectoryContainsFileWithExtension("src", ".cs")
        .DirectoryContainsFileWithExtension("tests", ".cs");
}
```

Using these assertions makes tests more expressive and maintainable, and also simplifies problem diagnosis when tests fail.