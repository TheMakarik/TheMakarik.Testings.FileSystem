`TheMakarik.Testing.FileSystem` provides a convenient interface for creating temporary files for integration tests, checking content and changes in these files. This is quite useful when testing components that are heavily tied to the file system.

In all following examples, we will use [xUnit.net](https://xunit.net/?tabs=cs) but you can use any testing framework you prefer, such as [NUnit](https://nunit.org/) or [TUnit](https://github.com/thomhurst/TUnit).

```csharp
using TheMakarik.Testing.FileSystem;

namespace LearnFileSystemProject;

// xUnit.net class
public class LearnFileSystem : IDisposable
{
    private readonly IFileSystem _fileSystem;
    private string _subDirectoryFileFullPath;
    
    public LearnFileSystem()
    {
        _fileSystem = FileSystem.BeginBuilding() // Creates an instance of IFileSystemBuilder
            .AddRoot("my-root-directory") // Adds a root folder for the file system, accepts full or relative path (project bin)
            .AddFile("my-file.txt") // Creates an empty file inside the folder (by default in the root folder)
            .AddDirectory((builder, path) => // builder - IFileSystemBuilder for the folder (like for root), path - full path to the folder
                   builder.AddFile("my-subdirectory-file", out _subDirectoryFileFullPath)) // _subDirectoryFileFullPath argument returning the full path to the created file or folder
            .Build();
    }      
    
    // Removal of the created file system is done by calling the  
    // Dispose method from IFileSystem
    public void Dispose()
    {
        _fileSystem.Dispose();
    }
}
```

From the example, we can see that creating file system content is quite simple, and it looks more organized and readable than calling standard `System.IO.Directory.CreateDirectory()` or `System.IO.File.Create()`.

The `AddFile` and `AddDirectory` methods are extension methods and have the following overloads.

## AddFile Method Overloads

### 1) Creating an Empty File
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath)
```
Adds a file to the root folder. `string rootRelativePath` - path to the file relative to the root folder, e.g., just a name (`mytxt.txt`) or with a folder that will be created automatically (`dir/mytxt.txt`).

**Note:** If the path contains subdirectories, they will be created automatically. The file is created empty (0 bytes).

### 2) Creating an Empty File with Full Path Retrieval
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, out string fullPath)
```
Adds a file to the root folder and returns the full path via `out string fullPath`.

### 3) Creating a File with Content
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, string content)
```
Adds a file with specified content. `string content` - file content as a string.

**Note:** Content is written with UTF-8 encoding without BOM.

### 4) Creating a File with Content and Full Path Retrieval
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, string content, out string fullPath)
```
Adds a file with specified content and returns the full path via `out string fullPath`.

## AddFiles Method Overloads (Multiple Files)

### 1) Creating Multiple Empty Files
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames)
```
Creates multiple empty files at the specified relative paths.

**Note:** All files are created empty (0 bytes). If paths contain subdirectories, they will be created automatically.

### 2) Creating Multiple Empty Files with Full Path Retrieval
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, out string[] filesFullPaths)
```
Creates multiple empty files and returns an array of full paths via `out string[] filesFullPaths`.

### 3) Creating Multiple Files with Identical Content
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, string content)
```
Creates multiple files with identical content.

**Note:** The same content is written to all specified files. Content is written with UTF-8 encoding without BOM.

### 4) Creating Multiple Files with Identical Content and Full Path Retrieval
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, string content, out string[] filesFullPaths)
```
Creates multiple files with identical content and returns an array of full paths via `out string[] filesFullPaths`.

## AddDirectory Method Overloads

### 1) Creating a Directory
```csharp
public static IFileSystemBuilder AddDirectory(this IFileSystemBuilder builder,
    string rootRelativePath,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Creates a directory at the specified relative path.

- `string rootRelativePath` - relative path to the directory from the root folder.
- `Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational` - optional function for lazy creation of directory content where string is the full path to the folder, and IFileSystemBuilder is the builder for the directory.

**Important Note:** When using `directoryContentLazyCreational`, the provided `IFileSystemBuilder` already has its Root set to the created directory. This means:
- All relative paths inside the lambda will be resolved from this directory
- You don't need to call `AddRoot()` inside the lambda
- You can directly use `AddFile("nested.txt")` to create files in this directory

**Usage Example:**
```csharp
.AddDirectory("subdir", (builder, path) =>
    builder.AddFile("nested1.txt")  // Creates subdir/nested1.txt
           .AddFile("nested2.txt")  // Creates subdir/nested2.txt
)
```

### 2) Creating a Directory with Full Path Retrieval
```csharp
public static IFileSystemBuilder AddDirectory(this IFileSystemBuilder builder,
    out string rootPath,
    string rootRelativePath,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Creates a directory and returns the full path via `out string rootPath`.

## AddDirectories Method Overloads (Multiple Directories)

### 1) Creating Multiple Directories
```csharp
public static IFileSystemBuilder AddDirectories(this IFileSystemBuilder builder,
    string[] directoriesRelativeNames,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Creates multiple directories at the specified relative paths.

**Note:** If `directoryContentLazyCreational` is specified, the same function is applied to all directories. To create different content for each directory, use multiple `AddDirectory` calls.

### 2) Creating Multiple Directories with Full Path Retrieval
```csharp
public static IFileSystemBuilder AddDirectories(this IFileSystemBuilder builder,
    string[] directoriesRelativeNames,
    out string[] directoriesRelativeFullPaths,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Creates multiple directories and returns an array of full paths via `out string[] directoriesRelativeFullPaths`.

## Usage Examples

### Example 1: Creating a Complex Directory Structure
```csharp
_fileSystem = FileSystem.BeginBuilding()
    .AddInTempRoot("test-project") // Creates root in temp folder
    .AddFile("config.json", "{ \"settings\": true }") // File with content
    .AddDirectory("logs", (builder, path) => 
        builder.AddFiles(new[] { "app.log", "debug.log" }, "Log content") // Multiple files with identical content
               .AddDirectory("archived", archivedBuilder => 
                   archivedBuilder.AddFile("old.log") // Nested directory structure
               )
    )
    .AddFiles(["data1.txt", "data2.txt"], "Sample data") // Multiple files in root
    .Build();
```

### Example 2: Creating a Unique Test Environment
```csharp
_fileSystem = FileSystem.BeginBuilding()
    .AddRandomInTempRootName(out string tempPath) // Unique name in temp folder
    .AddDirectory("test-data", (builder, path) =>
        builder.AddFiles(["input.txt", "output.txt"])
               .AddDirectory("backups")
    )
    .Build();
```