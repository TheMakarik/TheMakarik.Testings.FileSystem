`FileSystem` и `FileSystemBuilder` имеет довольно большое количество деталей для внутренней реализации, которые могут быть полезны для создания разширений или же

В первую очередь `IFileSystemBuilder` интерфейс имеет три метода, один из них это `AddRoot(string root)` который принимает абсолютный путь к **не созданной** директории, которая будет являться корневой для экземпляра `IFileSystem` а второй метод `Add(string rootRelativePath, Action<string, IFileSystemBuilder> additionalAction);` где `Action<string, IFileSystemBuilder> additionalAction` представляет собой действие по заполнению тестовой файловой системы, которое будет вызвано в методе `Build` у `IFileSystemBuilder`, и уже названный метод `Build()` возвращающий экземпляр интерфейса IFileSystemB


````csharp
 private readonly IFileSystem _fileSystem = FileSystem.BeginBuilding()
        .AddRoot("MY_TEST_TEMP_FOLDER")
        .AddFile("my-test-file.txt")  //Действие отложено до метода Build
        .AddFile("my-test-file2.txt", "has content")  //Действие отложено до метода Build
        .AddFile("my-test-file3.txt", "has content", out var fullPath)  //Действие отложено до метода Build
        .Build();
````

Учтите что если во время создания элементов `FileSystem` произойдет исключение, для того чтобы не получать `System.InvalidOperationException` связанное с тем что папка уже существует, все созданное содержимое корневой папки и она сама будут удалены

У `IFileSystemBuilder` есть несколько методов расширения сделанных для упрощения  создания корневой директории

#### 1) `AddInTempRoot(string root)`
```csharp
public static IFileSystemBuilder AddInTempRoot(this IFileSystemBuilder builder, string root)
```
Создает корневую директорию с указанным именем в системной временной папке. Директория будет расположена по пути `Path.GetTempPath()/root`.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки
- `root`: Имя директории для создания во временной папке

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Замечания:**
- На Windows: директория создается в `%TEMP%` (обычно `C:\Users\<username>\AppData\Local\Temp`)
- На Linux/macOS: директория создается в `/tmp`
- Директории в системной временной папке могут очищаться системой или пользователем

**Использование:**
```csharp
var fileSystem = FileSystem.BeginBuilding()
    .AddInTempRoot("my-test-directory")
    .Build();
```

#### 2) `AddInTempRoot(string root, out string fullPath)`
```csharp
public static IFileSystemBuilder AddInTempRoot(this IFileSystemBuilder builder, string root, out string fullPath)
```
Создает корневую директорию в системной временной папке и возвращает полный путь к созданной директории.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки
- `root`: Имя директории для создания во временной папке
- `fullPath`: Выходной параметр, содержащий полный путь к созданной директории

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Использование:**
```csharp
string rootPath;
var fileSystem = FileSystem.BeginBuilding()
    .AddInTempRoot("test-data", out rootPath)
    .Build();

// На Windows: "C:\Users\Username\AppData\Local\Temp\test-data"
// На Linux: "/tmp/test-data"
```

### Методы `AddRandomRootName`

#### 3) `AddRandomRootName()`
```csharp
public static IFileSystemBuilder AddRandomRootName(this IFileSystemBuilder builder)
```
Создает корневую директорию со случайно сгенерированным именем **в текущей рабочей директории**. Это означает, что директория будет создана там, откуда запущен тест.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Замечания:**
- Имя директории генерируется с помощью `Path.GetRandomFileName()`
- Директория создается относительно текущей рабочей директории
- **Не обеспечивает изоляции** от других тестов в той же папке
- Используйте, когда нужно сохранить файлы после теста для отладки

**Использование:**
```csharp
var fileSystem = FileSystem.BeginBuilding()
    .AddRandomRootName()
    .Build();
```

#### 4) `AddRandomRootName(out string rootName)`
```csharp
public static IFileSystemBuilder AddRandomRootName(this IFileSystemBuilder builder, out string rootName)
```
Создает корневую директорию со случайно сгенерированным именем в текущей рабочей директории и возвращает сгенерированное имя.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки
- `rootName`: Выходной параметр, содержащий сгенерированное случайное имя директории

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Использование:**
```csharp
string randomName;
var fileSystem = FileSystem.BeginBuilding()
    .AddRandomRootName(out randomName)
    .Build();

// randomName содержит случайное имя, например: "xfhnk4j2"
```

### Методы `AddRandomInTempRootName`

#### 5) `AddRandomInTempRootName()`
```csharp
public static IFileSystemBuilder AddRandomInTempRootName(this IFileSystemBuilder builder)
```
Создает корневую директорию со случайно сгенерированным именем **в системной временной папке**. Это обеспечивает лучшую изоляцию тестовых данных от основного проекта.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Замечания:**
- Имя директории генерируется с помощью `Path.GetRandomFileName()`
- **Обеспечивает изоляцию**: тестовые файлы создаются отдельно от кода проекта
- На Windows: директория создается в `%TEMP%`
- На Linux/macOS: директория создается в `/tmp`
- Файлы могут быть автоматически удалены системой после перезагрузки

**Использование:**
```csharp
var fileSystem = FileSystem.BeginBuilding()
    .AddRandomInTempRootName()
    .Build();
```

#### 6) `AddRandomInTempRootName(out string fullPath)`
```csharp
public static IFileSystemBuilder AddRandomInTempRootName(this IFileSystemBuilder builder, out string fullPath)
```
Создает корневую директорию со случайно сгенерированным именем в системной временной папке и возвращает полный путь к созданной директории.

**Параметры:**
- `builder`: Экземпляр `IFileSystemBuilder` для настройки
- `fullPath`: Выходной параметр, содержащий полный путь к созданной директории

**Возвращает:** Тот же экземпляр `IFileSystemBuilder` для цепочки вызовов

**Использование:**
```csharp
string fullPath;
var fileSystem = FileSystem.BeginBuilding()
    .AddRandomInTempRootName(out fullPath)
    .Build();

// На Windows: "C:\Users\Username\AppData\Local\Temp\xfhnk4j2"
// На Linux: "/tmp/xfhnk4j2"
```

### Пример с очисткой:
```csharp
using var fileSystem = FileSystem.BeginBuilding()
    .AddRandomInTempRootName()
    .AddFile("test.txt", "data")
    .Build();

// Тесты выполняются здесь
// Автоматическая очистка при Dispose()
```


В предыдущей главе документации уже рассматривалось создание файлов и папок в `IFileSystemBuilder`, все эти методы разширения вызывают метод `IFileSystemBuilder Add(string rootRelativePath, Action<string, IFileSystemBuilder> additionalAction);`
Этот метод используется для регистрации `Action<string, IFileSystemBuilder> additionalAction)` где string полный путь к файлу а `IFileSystemBuilder` - сам строитель, эти `Action` хранятся в `HashSet` до вызова метода `Build()` который выполнит их всех
**Пример**:

```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath)
{
    return builder
        .Add(rootRelativePath, (fullPath, _) => File.Create(fullPath).Dispose());
}
```

Вы можете создавать свои методы расширения работающие по такому же принципу
