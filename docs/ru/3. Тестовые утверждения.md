`TheMakarik.Testing.FileSystem` предоставляет расширенные возможности для проверки состояния файловой системы в интеграционных тестах. Ассерты (утверждения) позволяют удобно проверять содержимое файлов, структуру директорий и другие свойства файловой системы, что делает тестирование более читаемым и поддерживаемым.

## Пример использования ассертов

```csharp
using TheMakarik.Testing.FileSystem;

namespace LearnFileSystemProject;

public class AssertionExamples : IDisposable
{
    private IFileSystem _fileSystem;
    private string[] _filePaths;
    private string _directory1;
    
    public AssertionExamples()
    {
        _fileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFiles(["file-1.txt", "file-2.txt", "file-3.txt"], "Test content", out _filePaths)
            .AddDirectory("dir-1", out _directory1)
            .Build();
    }

    [Fact]
    public void File1_MustHaveContent()
    {
        _fileSystem.Should()
            .FileContentEquals("file-1.txt", "Test content");
    }

    [Fact]
    public void Directory1_MustHaveNoContent()
    {
        _fileSystem
            .Should()
            .HasNoDirectoryContent(_directory1);
    }

    [Fact]
    public void Files_MustExist()
    {
        _fileSystem.Should()
            .FileExists("file-1.txt")
            .FileExists("file-2.txt")
            .FileExists("file-3.txt");
    }

    [Fact]
    public void ConfigFile_MustBeValidJson()
    {
        _fileSystem = FileSystem.BeginBuilding()
            .AddRandomInTempRootName()
            .AddFile("config.json", "{ \"enabled\": true, \"timeout\": 30 }")
            .Build();

        _fileSystem.Should()
            .FileExists("config.json")
            .FileContains("config.json", "enabled")
            .FileMatchesRegex("config.json", "\"timeout\"\\s*:\\s*30");
    }
    
    public void Dispose()
    {
        _fileSystem.Dispose();
    }
}
```

Из примера мы видим что проверять состояние файловой системы достаточно просто, это выглядит более декларативно и читабельнее чем использование стандартных `Assert.True(File.Exists(...))` или `Assert.Equal(expected, File.ReadAllText(...))`.

Методы ассертов работают с fluent интерфейсом и имеют следующие перегрузки и категории.

## Основные методы ассертов

### Метод Should()
```csharp
public static IFileSystemAssertion Should(this IFileSystem fileSystem)
```
Создает экземпляр ассерта для указанной файловой системы. Все последующие проверки будут выполняться относительно корневой директории этой файловой системы.

## Проверки существования файлов и директорий

### 1) Проверка существования файла или директории
```csharp
public static IFileSystemAssertion Contains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что файл или директория существует по указанному пути. `string rootRelativePath` - относительный путь от корневой директории.

**Пример:**
```csharp
_fileSystem.Should().Contains("file.txt");
```

### 2) Проверка отсутствия файла или директории
```csharp
public static IFileSystemAssertion NotContains(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что файл или директория НЕ существует по указанному пути.

**Пример:**
```csharp
_fileSystem.Should().NotContains("deleted-file.txt");
```

### 3) Проверка существования конкретного файла
```csharp
public static IFileSystemAssertion FileExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что по указанному пути существует именно файл (не директория).

**Пример:**
```csharp
_fileSystem.Should().FileExists("config.json");
```

### 4) Проверка существования конкретной директории
```csharp
public static IFileSystemAssertion DirectoryExists(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что по указанному пути существует именно директория (не файл).

**Пример:**
```csharp
_fileSystem.Should().DirectoryExists("logs");
```

## Проверки содержимого файлов

### 1) Проверка что файл не пустой
```csharp
public static IFileSystemAssertion BeNotEmptyFile(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что файл существует и содержит хотя бы одну строку.

**Пример:**
```csharp
_fileSystem.Should().BeNotEmptyFile("log.txt");
```

### 2) Проверка точного соответствия содержимого
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content)
```
Проверяет что содержимое файла точно соответствует указанной строке. Сравнение выполняется с учетом регистра.

**Пример:**
```csharp
_fileSystem.Should().FileContentEquals("readme.txt", "Hello World!");
```

### 3) Проверка точного соответствия содержимого с указанием сравнения
```csharp
public static IFileSystemAssertion FileContentEquals(
    this IFileSystemAssertion assertion, 
    string rootRelativePath,
    string content,
    StringComparison comparisonType)
```
Проверяет что содержимое файла соответствует указанной строке с использованием заданных правил сравнения.

**Пример:**
```csharp
_fileSystem.Should().FileContentEquals("config.txt", "ENABLED=true", StringComparison.OrdinalIgnoreCase);
```

### 4) Проверка что файл содержит указанный текст
```csharp
public static IFileSystemAssertion FileContains(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string text, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Проверяет что файл содержит указанный текст. Можно задать правила сравнения строк.

**Пример:**
```csharp
_fileSystem.Should()
    .FileContains("log.txt", "ERROR")
    .FileContains("config.txt", "localhost", StringComparison.OrdinalIgnoreCase);
```

### 5) Проверка что файл соответствует регулярному выражению
```csharp
public static IFileSystemAssertion FileMatchesRegex(this IFileSystemAssertion assertion, string rootRelativePath, string pattern)
```
Проверяет что содержимое файла соответствует указанному регулярному выражению.

**Пример:**
```csharp
_fileSystem.Should().FileMatchesRegex("config.txt", "^\\s*\\w+\\s*=\\s*\\w+\\s*$");
```

### 6) Проверка что файл начинается с указанного текста
```csharp
public static IFileSystemAssertion FileStartsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string startingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Проверяет что файл начинается с указанного текста.

**Пример:**
```csharp
_fileSystem.Should().FileStartsWith("script.sh", "#!/bin/bash");
```

### 7) Проверка что файл заканчивается указанным текстом
```csharp
public static IFileSystemAssertion FileEndsWith(
    this IFileSystemAssertion assertion, 
    string rootRelativePath, 
    string endingText, 
    StringComparison stringComparison = StringComparison.Ordinal)
```
Проверяет что файл заканчивается указанным текстом.

**Пример:**
```csharp
_fileSystem.Should().FileEndsWith("data.json", "\n}");
```

## Проверки размера файлов

### 1) Проверка что файл пустой
```csharp
public static IFileSystemAssertion FileIsEmpty(this IFileSystemAssertion assertion, string rootRelativePath)
```
Проверяет что файл существует и имеет размер 0 байт.

**Пример:**
```csharp
_fileSystem.Should().FileIsEmpty("placeholder.txt");
```

### 2) Проверка размера файла
```csharp
public static IFileSystemAssertion FileHasSize(this IFileSystemAssertion assertion, string rootRelativePath, long expectedSize)
```
Проверяет что файл имеет указанный размер в байтах.

**Пример:**
```csharp
_fileSystem.Should().FileHasSize("data.bin", 1024); // 1KB
```

## Проверки дат файлов

### 1) Проверка что файл был изменен после указанной даты
```csharp
public static IFileSystemAssertion FileModifiedAfter(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Проверяет что файл был изменен после указанной даты и времени.

**Пример:**
```csharp
_fileSystem.Should().FileModifiedAfter("log.txt", DateTime.Now.AddHours(-1));
```

### 2) Проверка что файл был создан до указанной даты
```csharp
public static IFileSystemAssertion FileCreatedBefore(this IFileSystemAssertion assertion, string rootRelativePath, DateTime dateTime)
```
Проверяет что файл был создан до указанной даты и времени.

**Пример:**
```csharp
_fileSystem.Should().FileCreatedBefore("archive.zip", DateTime.Now.AddDays(-7));
```

## Проверки атрибутов файлов

### 1) Проверка наличия атрибутов файла
```csharp
public static IFileSystemAssertion FileHasAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Проверяет что файл имеет указанные атрибуты.

**Пример:**
```csharp
_fileSystem.Should().FileHasAttributes("script.sh", FileAttributes.Archive | FileAttributes.ReadOnly);
```

### 2) Проверка отсутствия атрибутов файла
```csharp
public static IFileSystemAssertion FileDoesNotHaveAttributes(this IFileSystemAssertion assertion, string rootRelativePath, FileAttributes attributes)
```
Проверяет что файл НЕ имеет указанных атрибутов.

**Пример:**
```csharp
_fileSystem.Should().FileDoesNotHaveAttributes("data.txt", FileAttributes.Hidden);
```

## Проверки директорий

### 1) Проверка что директория пустая
```csharp
public static IFileSystemAssertion HasNoDirectoryContent(this IFileSystemAssertion assertion, string? rootRelativePath = null)
```
Проверяет что директория не содержит файлов или поддиректорий. Если параметр не указан, проверяет корневую директорию.

**Пример:**
```csharp
_fileSystem.Should()
    .HasNoDirectoryContent("empty-dir")
    .HasNoDirectoryContent(); // Проверяет корневую директорию
```

### 2) Проверка количества файлов в директории
```csharp
public static IFileSystemAssertion DirectoryHasFileCount(this IFileSystemAssertion assertion, string rootRelativePath, int expectedCount)
```
Проверяет что директория содержит указанное количество файлов.

**Пример:**
```csharp
_fileSystem.Should().DirectoryHasFileCount("logs", 5);
```

### 3) Проверка наличия файлов с определенным расширением
```csharp
public static IFileSystemAssertion DirectoryContainsFileWithExtension(this IFileSystemAssertion assertion, string rootRelativePath, string extension)
```
Проверяет что директория содержит хотя бы один файл с указанным расширением.

**Пример:**
```csharp
_fileSystem.Should().DirectoryContainsFileWithExtension("documents", ".pdf");
```

## Сравнение файлов

### 1) Сравнение двух файлов
```csharp
public static IFileSystemAssertion FilesAreEqual(this IFileSystemAssertion assertion, string firstFilePath, string secondFilePath)
```
Проверяет что содержимое двух файлов идентично (побайтовое сравнение).

**Пример:**
```csharp
_fileSystem.Should().FilesAreEqual("original.txt", "backup.txt");
```

## Пользовательские проверки

### 1) Пользовательская проверка
```csharp
public static IFileSystemAssertion ItemBe(this IFileSystemAssertion assertion, string rootRelativePath, Predicate<string> predicate)
```
Позволяет выполнить пользовательскую проверку с помощью указанного предиката. Предикат получает полный путь к файлу или директории.

**Пример:**
```csharp
_fileSystem.Should().ItemBe("data.csv", path => 
{
    var content = File.ReadAllText(path);
    return content.Contains("Total") && content.EndsWith("\n");
});
```

## Примеры использования

### Пример 1: Комплексная проверка конфигурации приложения
```csharp
[Fact]
public void ApplicationConfiguration_ShouldBeValid()
{
    _fileSystem.Should()
        .FileExists("appsettings.json")
        .FileContains("appsettings.json", "\"ConnectionStrings\"")
        .FileMatchesRegex("appsettings.json", "\"Logging\"\\s*:")
        .FileHasSize("appsettings.json", size => size > 100 && size < 10000)
        .DirectoryExists("logs")
        .DirectoryHasFileCount("logs", 3)
        .DirectoryContainsFileWithExtension("logs", ".log");
}
```

### Пример 2: Проверка временных файлов
```csharp
[Fact]
public void TemporaryFiles_ShouldBeCleanedUp()
{
    // После выполнения операции очистки
    _fileSystem.Should()
        .NotContains("temp-data.tmp")
        .NotContains("cache.bin")
        .HasNoDirectoryContent("temp")
        .FileExists("permanent-config.xml")
        .FileContentEquals("permanent-config.xml", "<config></config>");
}
```

### Пример 3: Проверка прав доступа
```csharp
[Fact]
public void SecurityFiles_ShouldHaveCorrectPermissions()
{
    _fileSystem.Should()
        .FileHasAttributes("secret.key", FileAttributes.ReadOnly)
        .FileDoesNotHaveAttributes("public.txt", FileAttributes.ReadOnly)
        .FileExists("admin-credentials.txt")
        .FileHasAttributes("admin-credentials.txt", FileAttributes.Hidden);
}
```

### Пример 4: Проверка структуры проекта
```csharp
[Fact]
public void ProjectStructure_ShouldBeCorrect()
{
    _fileSystem.Should()
        .DirectoryExists("src")
        .DirectoryExists("tests")
        .FileExists("README.md")
        .FileExists("LICENSE")
        .FileExists(".gitignore")
        .FileContains("README.md", "# Project Name")
        .DirectoryContainsFileWithExtension("src", ".cs")
        .DirectoryContainsFileWithExtension("tests", ".cs");
}
```

Использование этих ассертов делает тесты более выразительными и поддерживаемыми, а также упрощает диагностику проблем при падении тестов.