`TheMakarik.Testing.FileSystem` представляет достаточно удобный интерфейс для создания временных файлов для интеграционных тестов, проверки на содержание и изменения этих файлов. Что довольно полезно при тестировании компонентов которые очень сильно привязаны к файловой системе.

Во всех следующих примерах мы будем использовать [xUnit.net](https://xunit.net/?tabs=cs) но вы можете использовать любой тестовый фреймворк который вам по душе, например [NUnit](https://nunit.org/) или [TUnit](https://github.com/thomhurst/TUnit).

```csharp
using TheMakarik.Testing.FileSystem;

namespace LearnFileSystemProject;

//xUnit.net class
public class LearnFileSystem : IDisposable
{
    private readonly IFileSystem _fileSystem;
    private string _subDirectoryFileFullPath;
    
    public LearnFileSystem()
    {
        _fileSystem = FileSystem.BeginBuilding() //Создает экземпляр IFileSystemBuilder для создания класса
            .AddRoot("my-root-directory") //Добавляет корневую папку для файловой системы, принимает полный путь или относительный (bin проекта)
            .AddFile("my-file.txt") //Cоздает пустой файл внутри папки (по умолчанию в корневой папке)
            .AddDirectory((builder, path) => //builder - IFileSystemBuilder для папки (как для коренной), path - полный путь к папке
                   builder.AddFile("my-subdirectory-file", out _subDirectoryFileFullPath)) //_subDirectoryFileFullPath аргумент возвразающий полный путь к созданному файлу или папке
            .Build();
    }      
    
    //Удаление созданной файловой системы проводиться с вызовом метода  
    //Dispose из IFileSystem
    public void Dispose()
    {
        _fileSystem.Dispose();
    }
}
```

Из примера мы видим что создавать содержимое файловой системы достаточно просто, это выглядит более аккуратно и читабельнее чем вызывая стандартные `System.IO.Directory.CreateDirectory()` или `System.IO.File.Create()`.

Методы `AddFile` и `AddDirectory` являются методами расширения и имеют следующие перегрузки.

## Перегрузки метода AddFile

### 1) Создание пустого файла
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath)
```
Добавляет файл в корневую папку. `string rootRelativePath` - путь к файлу относительно коренной папки, например просто название (`mytxt.txt`) или же с папкой, которая будет создана автоматически (`dir/mytxt.txt`).

**Примечание:** Если путь содержит поддиректории, они будут созданы автоматически. Файл создается пустым (0 байт).

### 2) Создание пустого файла с получением полного пути
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, out string fullPath)
```
Добавляет файл в корневую папку и возвращает полный путь через `out string fullPath`.

### 3) Создание файла с содержимым
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, string content)
```
Добавляет файл с указанным содержимым. `string content` - содержимое файла в виде строки.

**Примечание:** Содержимое записывается с кодировкой UTF-8 без BOM.

### 4) Создание файла с содержимым и получением полного пути
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, string content, out string fullPath)
```
Добавляет файл с указанным содержимым и возвращает полный путь через `out string fullPath`.

### 5) Создание файла из `Stream`
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, Stream contentStream)
```
Создает файл и записывает в него данные из переданного `Stream`. Удобно, когда содержимое уже доступно в виде потока (например, из сети или другого файла).

### 6) Создание файла из `Stream` с получением полного пути
```csharp
public static IFileSystemBuilder AddFile(this IFileSystemBuilder builder, string rootRelativePath, Stream contentStream, out string fullPath)
```
Создает файл из потока и возвращает его полный путь через `out string fullPath`.

## Перегрузки метода AddFiles (множественные файлы)

### 1) Создание нескольких пустых файлов
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames)
```
Создает несколько пустых файлов по указанным относительным путям.

**Примечание:** Все файлы создаются пустыми (0 байт). Если пути содержат поддиректории, они будут созданы автоматически.

### 2) Создание нескольких пустых файлов с получением полных путей
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, out string[] filesFullPaths)
```
Создает несколько пустых файлов и возвращает массив полных путей через `out string[] filesFullPaths`.

### 3) Создание нескольких файлов с одинаковым содержимым
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, string content)
```
Создает несколько файлов с одинаковым содержимым.

**Примечание:** Одно и то же содержимое записывается во все указанные файлы. Содержимое записывается с кодировкой UTF-8 без BOM.

### 4) Создание нескольких файлов с одинаковым содержимым и получением полных путей
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, string content, out string[] filesFullPaths)
```
Создает несколько файлов с одинаковым содержимым и возвращает массив полных путей через `out string[] filesFullPaths`.

### 5) Создание нескольких файлов с одинаковым содержимым из `Stream`
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, Stream contentStream)
```
Создает несколько файлов и записывает одно и то же содержимое из переданного `Stream` во все файлы.

### 6) Создание нескольких файлов из `Stream` с получением полных путей
```csharp
public static IFileSystemBuilder AddFiles(this IFileSystemBuilder builder, string[] filesRelativeNames, Stream contentStream, out string[] filesFullPaths)
```
Создает несколько файлов из потока и заполняет массив `filesFullPaths` полными путями к созданным файлам.

## Перегрузки метода AddDirectory

### 1) Создание директории
```csharp
public static IFileSystemBuilder AddDirectory(this IFileSystemBuilder builder,
    string rootRelativePath,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Создает директорию по указанному относительному пути.

- `string rootRelativePath` - относительный путь к директории от корневой папки.
- `Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational` - опциональная функция для ленивого создания содержимого директории где string - полный путь к папке, а IFileSystemBuilder - билдер для директории.

**Важное примечание:** Когда используется `directoryContentLazyCreational`, переданный `IFileSystemBuilder` уже имеет установленный Root в созданную директорию. Это означает:
- Все относительные пути внутри лямбды будут разрешаться от этой директории
- Вам не нужно вызывать `AddRoot()` внутри лямбды
- Вы можете напрямую использовать `AddFile("вложенный.txt")` для создания файлов в этой директории

**Пример использования:**
```csharp
.AddDirectory("subdir", (builder, path) =>
    builder.AddFile("nested1.txt")  // Создает subdir/nested1.txt
           .AddFile("nested2.txt")  // Создает subdir/nested2.txt
)
```

### 2) Создание директории с получением полного пути
```csharp
public static IFileSystemBuilder AddDirectory(this IFileSystemBuilder builder,
    out string rootPath,
    string rootRelativePath,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Создает директорию и возвращает полный путь через `out string rootPath`.

## Перегрузки метода AddDirectories (множественные директории)

### 1) Создание нескольких директорий
```csharp
public static IFileSystemBuilder AddDirectories(this IFileSystemBuilder builder,
    string[] directoriesRelativeNames,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Создает несколько директорий по указанным относительным путям.

**Примечание:** Если указана `directoryContentLazyCreational`, та же функция применяется ко всем директориям. Для создания разного содержимого для каждой директории используйте несколько вызовов `AddDirectory`.

### 2) Создание нескольких директорий с получением полных путей
```csharp
public static IFileSystemBuilder AddDirectories(this IFileSystemBuilder builder,
    string[] directoriesRelativeNames,
    out string[] directoriesRelativeFullPaths,
    Func<string, IFileSystemBuilder, IFileSystemBuilder>? directoryContentLazyCreational = null)
```
Создает несколько директорий и возвращает массив полных путей через `out string[] directoriesRelativeFullPaths`.

## Примеры использования

### Пример 1: Создание сложной структуры директорий
```csharp
_fileSystem = FileSystem.BeginBuilding()
    .AddInTempRoot("test-project") // Создает корень в временной папке
    .AddFile("config.json", "{ \"settings\": true }") // Файл с содержимым
    .AddDirectory("logs", (builder, path) => 
        builder.AddFiles(new[] { "app.log", "debug.log" }, "Log content") // Несколько файлов с одинаковым содержимым
               .AddDirectory("archived", archivedBuilder => 
                   archivedBuilder.AddFile("old.log") // Вложенная структура директорий
               )
    )
    .AddFiles(["data1.txt", "data2.txt"], "Sample data") // Несколько файлов в корне
    .Build();
```

### Пример 2: Создание уникальной тестовой среды
```csharp
_fileSystem = FileSystem.BeginBuilding()
    .AddRandomInTempRootName(out string tempPath) // Уникальное имя в temp папке
    .AddDirectory("test-data", (builder, path) =>
        builder.AddFiles(["input.txt", "output.txt"])
               .AddDirectory("backups")
    )
    .Build();
```
